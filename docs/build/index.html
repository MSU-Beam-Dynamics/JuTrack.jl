<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · JuTrack.jl</title><meta name="title" content="Home · JuTrack.jl"/><meta property="og:title" content="Home · JuTrack.jl"/><meta property="twitter:title" content="Home · JuTrack.jl"/><meta name="description" content="Documentation for JuTrack.jl."/><meta property="og:description" content="Documentation for JuTrack.jl."/><meta property="twitter:description" content="Documentation for JuTrack.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>JuTrack.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Citation"><span>Citation</span></a></li><li class="toplevel"><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li class="toplevel"><a class="tocitem" href="#Use-the-package-in-Julia"><span>Use the package in Julia</span></a></li><li class="toplevel"><a class="tocitem" href="#Lattice-definition"><span>Lattice definition</span></a></li><li class="toplevel"><a class="tocitem" href="#Particle-tracking"><span>Particle tracking</span></a></li><li class="toplevel"><a class="tocitem" href="#Optics-calculation"><span>Optics calculation</span></a></li><li class="toplevel"><a class="tocitem" href="#Automatic-differentiation"><span>Automatic differentiation</span></a></li><li class="toplevel"><a class="tocitem" href="#Parallel-computation-setting"><span>Parallel computation setting</span></a></li><li class="toplevel"><a class="tocitem" href="#Precompile"><span>Precompile</span></a></li><li class="toplevel"><a class="tocitem" href="#Known-issues"><span>Known issues</span></a></li></ul></li><li><a class="tocitem" href="api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/MSU-Beam-Dynamics/JuTrack.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/MSU-Beam-Dynamics/JuTrack.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="JuTrack"><a class="docs-heading-anchor" href="#JuTrack">JuTrack</a><a id="JuTrack-1"></a><a class="docs-heading-anchor-permalink" href="#JuTrack" title="Permalink"></a></h1><p>A Julia-based package that enables advanced auto differentiation (AD) for symplectic 6-D particle tracking in particle accelerators. A mannual can be found at docs.</p><h1 id="Citation"><a class="docs-heading-anchor" href="#Citation">Citation</a><a id="Citation-1"></a><a class="docs-heading-anchor-permalink" href="#Citation" title="Permalink"></a></h1><pre><code class="nohighlight hljs">@article{WAN2025109497,
title = {JuTrack: A Julia package for auto-differentiable accelerator modeling and particle tracking},
journal = {Computer Physics Communications},
volume = {309},
pages = {109497},
year = {2025},
issn = {0010-4655},
doi = {https://doi.org/10.1016/j.cpc.2024.109497},
url = {https://www.sciencedirect.com/science/article/pii/S001046552400420X},
author = {Jinyu Wan and Helena Alamprese and Christian Ratcliff and Ji Qiang and Yue Hao}
}</code></pre><h1 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h1><ul><li><p>Install Julia at <a href="https://julialang.org/downloads/oldreleases/">here</a>.</p></li><li><p>Download the package:</p></li></ul><pre><code class="nohighlight hljs">git clone https://github.com/MSU-Beam-Dynamics/JuTrack.jl</code></pre><ul><li>Since Julia and its packages are under very active development, it is strongly recommended to create a separate environment for each piece of work.</li></ul><p>To create a &quot;JuTrack&quot; environment and install all dependencies (errors may occur if not using this method to install all dependencies):</p><pre><code class="nohighlight hljs">cd JuTrack.jl
julia --project=. -e &quot;using Pkg; Pkg.instantiate()&quot;</code></pre><h1 id="Use-the-package-in-Julia"><a class="docs-heading-anchor" href="#Use-the-package-in-Julia">Use the package in Julia</a><a id="Use-the-package-in-Julia-1"></a><a class="docs-heading-anchor-permalink" href="#Use-the-package-in-Julia" title="Permalink"></a></h1><p>Activate the JuTrack environment we just created in the Julia code (change below path to your JuTrack directory accordingly):</p><pre><code class="nohighlight hljs">using Pkg
Pkg.activate(&quot;/path/to/JuTrack.jl&quot;) # use the correct Julia environment
Pkg.instantiate()                   # check if all dependencies are correctly installed</code></pre><p>Import JuTrack in Julia:</p><pre><code class="nohighlight hljs">using JuTrack</code></pre><h1 id="Lattice-definition"><a class="docs-heading-anchor" href="#Lattice-definition">Lattice definition</a><a id="Lattice-definition-1"></a><a class="docs-heading-anchor-permalink" href="#Lattice-definition" title="Permalink"></a></h1><pre><code class="nohighlight hljs">D1 = DRIFT(name=&quot;D1&quot;, len=1.0)
D2 = DRIFT(name=&quot;D2&quot;, len=1.0)
D3 = DRIFT(name=&quot;D3&quot;, len=1.0)
D4 = DRIFT(name=&quot;D4&quot;, len=1.0)
Q1 = KQUAD(name=&quot;Q1&quot;, len=1.0, k1=-0.9) 
Q2 = KQUAD(name=&quot;Q2&quot;, len=1.0, k1=0.3)
B1 = SBEND(name=&quot;B1&quot;, len=0.6, angle=pi/15.0)</code></pre><p>Create the lattice as a Julia vector</p><pre><code class="nohighlight hljs">LINE = [D1, Q1, D2, B1, D3, Q2, D4]</code></pre><h1 id="Particle-tracking"><a class="docs-heading-anchor" href="#Particle-tracking">Particle tracking</a><a id="Particle-tracking-1"></a><a class="docs-heading-anchor-permalink" href="#Particle-tracking" title="Permalink"></a></h1><p>Particles&#39; coordinates are represented as a N * 6 matrix, saved in beam.r</p><pre><code class="nohighlight hljs">particles = rand(10, 6) / 1000
beam = Beam(particles, energy=3.5e9)</code></pre><p>Tracking</p><pre><code class="nohighlight hljs">linepass!(LINE, beam) # or ringpass!(RING, beam, nturns) for multi-turn tracking
println(beam.r) </code></pre><h1 id="Optics-calculation"><a class="docs-heading-anchor" href="#Optics-calculation">Optics calculation</a><a id="Optics-calculation-1"></a><a class="docs-heading-anchor-permalink" href="#Optics-calculation" title="Permalink"></a></h1><p>Obtain periodic Twiss parameters of a ring accelerator</p><pre><code class="nohighlight hljs">twi = periodicEdwardsTengTwiss(RING, 0.0, 0)</code></pre><h1 id="Automatic-differentiation"><a class="docs-heading-anchor" href="#Automatic-differentiation">Automatic differentiation</a><a id="Automatic-differentiation-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-differentiation" title="Permalink"></a></h1><p>We provide two options for fast AD calculation, fastTPSA and Enzyme. fastTPSA is a first-order TPSA module, and Enzyme is a third-party package that runs AD at compiler level. Both methods provide comparably fast AD. The fastTPSA is written in pure Julia that is supposed to be more stable. While Enzyme supports all kinds of differentiable functions, which is not limited by the tracking code in JuTrack.</p><p>fastTPSA example: Obtain derivatives of tracking result w.r.t the quadrupole strength k1</p><pre><code class="nohighlight hljs">set_tps_dim(2) # 2 variables for fastTPSA
function tracking_wrt_k1(x1::DTPSAD{NVAR(), Float64}, x2::DTPSAD{NVAR(), Float64})
    D1 = DRIFT(len=DTPSAD(1.0))        # We use parametric elements in JuTrack.  
    D2 = DRIFT(len=DTPSAD(1.0))        # When any of the parameters is a DTPSAD type, the element will be ELEMENT{DTPSAD}
    Q1 = KQUAD(len=DTPSAD(1.0))        # Otherwise, the element will be ELEMENT{Float64}
    Q2 = KQUAD(len=DTPSAD(1.0))

    Q1.k1 = x1
    Q2.k1 = x2

    beam = Beam(DTPSAD.([0.1 0.0 0.0 0.0 0.0 0.0]))

    LINE = [D1, Q1, D2, Q2] 
    linepass!(LINE, beam)
    return beam.r
end
k1 = -0.9
k2 = 0.3
g, r = Jacobian(tracking_wrt_k1, [k1, k2], true)</code></pre><p>Enzyme example: Obtain derivatives of tracking result w.r.t the quadrupole strength k1</p><pre><code class="nohighlight hljs">function tracking_wrt_k1(X)
    D1 = DRIFT(len=1.0)
    D2 = DRIFT(len=1.0)
    Q1 = KQUAD(len=1.0, k1=X[1]) 
    Q2 = KQUAD(len=1.0, k1=X[2])

    beam = Beam([0.1 0.0 0.0 0.0 0.0 0.0])

    LINE = [D1, Q1, D2, Q2] 
    linepass!(LINE, beam)
    return beam.r
end
k1 = -0.9
k2 = 0.3
derivatives, results = jacobian(ForwardWithPrimal, tracking_wrt_k1, [k1, k2])</code></pre><h1 id="Parallel-computation-setting"><a class="docs-heading-anchor" href="#Parallel-computation-setting">Parallel computation setting</a><a id="Parallel-computation-setting-1"></a><a class="docs-heading-anchor-permalink" href="#Parallel-computation-setting" title="Permalink"></a></h1><p>Multi-threading is available for multi-particle tracking.  Before using it, please ensure the Julia multi-threading is set up correctly by typing:</p><pre><code class="nohighlight hljs">println(&quot;Number of threads in use: &quot;, Threads.nthreads())</code></pre><p>Parallel computing is available for multi-particle tracking using:</p><pre><code class="nohighlight hljs">plinepass!(beamline, beam)</code></pre><p>or </p><pre><code class="nohighlight hljs">pringpass!(beamline, beam, nturns)</code></pre><h1 id="Precompile"><a class="docs-heading-anchor" href="#Precompile">Precompile</a><a id="Precompile-1"></a><a class="docs-heading-anchor-permalink" href="#Precompile" title="Permalink"></a></h1><p>Julia compiles functions the first time they are called (Just-In-Time, JIT). For complex code, this first call can take from seconds to minutes, and the cost repeats every time a new Julia process starts.</p><p>A custom sysimage precompiles those methods ahead of time, so loading and running functions has little to no latency, making Julia feel much closer to a traditional compiled language.</p><p>We provide ready-made helper scripts under the precompile/ directory. The file <em>agg</em>warmup.jl includes some sample functions. Add the function calls you want Julia to precompile in this file, and remove any you don&#39;t need to reduce the size of the sysimage.</p><ol><li>Test precompile statements. Move to the JuTrack.jl folder, and type</li></ol><p>Windows (PowerShell/CMD):</p><pre><code class="nohighlight hljs">julia --project=. --trace-compile=precompile\trace_base.jl precompile\run_warmup.jl</code></pre><p>macOS/Linux:</p><pre><code class="nohighlight hljs">julia --project=. --trace-compile=precompile/trace_base.jl precompile/run_warmup.jl</code></pre><ol><li>Build the sysimage</li></ol><p>Windows:</p><pre><code class="nohighlight hljs">julia --project=. precompile\build_sysimage.jl</code></pre><p>macOS/Linux:</p><pre><code class="nohighlight hljs">julia --project=. precompile/build_sysimage.jl</code></pre><p>This creates precompile/JuTrack_sysimage.(dll|dylib|so) for your platform.</p><ol><li>Use it</li></ol><p>Windows:</p><pre><code class="nohighlight hljs">julia --sysimage=precompile\JuTrack_sysimage.dll your_code.jl</code></pre><p>macOS:</p><pre><code class="nohighlight hljs">julia --sysimage=precompile/JuTrack_sysimage.dylib your_code.jl</code></pre><p>Linux:</p><pre><code class="nohighlight hljs">julia --sysimage=precompile/JuTrack_sysimage.so your_code.jl</code></pre><h1 id="Known-issues"><a class="docs-heading-anchor" href="#Known-issues">Known issues</a><a id="Known-issues-1"></a><a class="docs-heading-anchor-permalink" href="#Known-issues" title="Permalink"></a></h1><ul><li>JuTrack is actively under development. If you encounter any issues, please open an issue on GitHub or email wan@frib.msu.edu.</li><li>Please ensure using the same OS and Julia verion when using a precompiled sysimage.</li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Monday 3 November 2025 14:56">Monday 3 November 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
